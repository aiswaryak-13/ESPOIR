<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Confirm OTP</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Aclonica Font -->
  <link href="https://fonts.googleapis.com/css2?family=Aclonica&display=swap" rel="stylesheet">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f8f9fa;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Arial', sans-serif;
    }

    .otp-card {
      border-radius: 20px;
      overflow: hidden;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      background-color: #fff;
    }

    .otp-left {
      background-color: #f0f0f0;
      text-align: center;
      padding: 2rem 1rem;
    }

    .otp-left img {
      width: 100%;
      max-width: 250px;
      border-radius: 10px;
    }

    .brand-name {
      margin-top: 1rem;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .otp-right {
      padding: 2rem;
    }

    .otp-heading {
      font-family: 'Aclonica', sans-serif;
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .otp-input input {
      width: 400px;
      height: 50px;
      text-align: center;
      font-size: 1.5rem;
      margin-right: 10px;
      border-radius: 8px;
    }

    .otp-timer {
      margin-top: 10px;
      font-size: 0.9rem;
      color: #888;
    }

    .confirm-btn {
      background-color: #6c757d;
      color: white;
      border: none;
    }

    .confirm-btn:hover {
      background-color: #5a6268;
    }

    .login-link {
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #007bff;
      cursor: pointer;
    }

    .expired {
    color: red;
    font-weight: bold;
    }
    #timerValue {
    color: red;
    font-weight: bold;
    }

    @media (max-width: 768px) {
      .otp-card {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="d-flex otp-card">
    <!-- Left Side -->
    <div class="col-md-6 otp-left d-flex flex-column align-items-center justify-content-center">
      <img src="https://via.placeholder.com/250x200" alt="Product Image" />
      <div class="brand-name">BrandName</div>
    </div>

    <!-- Right Side -->
     
    <div class="col-md-6 otp-right">
      <form action="/verfiyOtp" id="otpForm" method="post" onsubmit="return validateOTPForm()">
      <div class="otp-heading">Confirm OTP</div>
      <p>Please check your email address for password</p>

      <!-- OTP Inputs -->
      <div class="d-flex otp-input mb-3">
        <input type="text" maxlength="4" class="form-control" id="otp" name="otp" required pattern="\d*">
      </div>

      <div class="otp-timer">
        Time left: <span id="timerValue">01:00</span> <br />
        Didn't receive OTP? <button type="button" onclick="resendOTP()">Resend</button>
      </div>

      <!-- Confirm Button -->
      <button class="btn confirm-btn w-100 mt-3">Confirm</button>

      <!-- Back to Login -->
      <div class="login-link text-center mt-3">
      <a href="/login">Go back to Login Page</a>
    </div>
    </form>
    </div>
  
  
  </div>
 
  <script>
    document.getElementById('otp').focus();

    let timer = 60;
    let timerInterval;

    function startTimer(){
      timerInterval = setInterval(()=>{
        timer--;
        const minutes = Math.floor(timer / 60);
    const seconds = timer % 60;
    const formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

    document.getElementById('timerValue').textContent = formattedTime;

    if (timer <= 0) {
      clearInterval(timerInterval);
      document.getElementById('timerValue').classList.add('expired');
      document.getElementById('timerValue').textContent = 'Expired';
      document.getElementById('otp').disabled = true;
    }
      },1000);
    }

    startTimer();

    function validateOTPForm(){
        const otpInput = document.getElementById('otp').value;

        $.ajax({
          type:"POST",
          url:"/verifyOtp",
          data:{otp:otpInput},
          success:(response)=>{
            if(response.success){
              Swal.fire({
                icon:'success',
                title:'OTP verified successfully',
                showConfirmButton:false,
                timer:1500
              }).then(()=>{
                window.location.href = response.redirectUrl;
              })
            }else{
              Swal.fire({
                icon:"error",
                title:'Error',
                text:response.message,
              })
            }
          },
          error:()=>{
            Swal.fire({
              icon:'error',
              title:'Invalid OTP',
              text:'Please try again'
            })
          }
        })
        return false;
    }

    function resendOTP() {
    clearInterval(timerInterval);
    timer = 60;
    document.getElementById('otp').disabled = false;
    document.getElementById('timerValue').classList.remove('expired');

    const resendBtn = document.querySelector('button[onclick="resendOTP()"]');
    resendBtn.disabled = true;
    setTimeout(() => resendBtn.disabled = false, 60000);

    startTimer();

    
    $.ajax({
      type: "POST",
      url: "/resendOtp", 
      success:(response)=>{
        if (response.success){
          Swal.fire({
          icon: 'success',
          title: 'OTP Resent',
          showConfirmButton: false,
          timer: 1500,

        })
        }else{
          Swal.fire({
            icon:'error',
            title:'Error',
            text:'An error occured while resending otp. Please try again',

          })
        }
      }

    });
    return false;
  }
  </script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
